{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nimport { reactive } from \"vue\";\nimport { useAuthStore } from \"@/storage/userStorage\";\nimport { useRouter } from \"vue-router\";\nimport { Form, Input, Button, Card, Layout, InputPassword, message } from \"ant-design-vue\";\nexport default {\n  components: {\n    \"a-layout\": Layout,\n    \"a-layout-content\": Layout.Content,\n    \"a-card\": Card,\n    \"a-form-item\": Form.Item,\n    \"a-input\": Input,\n    \"a-input-password\": InputPassword,\n    \"a-button\": Button\n  },\n  data() {\n    return {\n      registerForm: reactive({\n        username: \"\",\n        password: \"\",\n        confirm: \"\",\n        employeeKey: \"\",\n        phone: \"\"\n      }),\n      rules: {\n        username: [{\n          required: false,\n          message: \"请输入正确的用户名\",\n          trigger: /^\\S{4,10}$/\n        }],\n        password: [{\n          required: false,\n          message: \"请输入正确的密码\",\n          pattern: /^\\S{8,16}$/\n        }],\n        confirm: [{\n          required: false,\n          message: \"请确认密码\",\n          trigger: \"blur\"\n        }, {\n          validator: (_, value) => {\n            // 使用箭头函数来捕获外围作用域中的 this\n            if (!value || value === this.registerForm.password) {\n              return Promise.resolve();\n            }\n            return Promise.reject(new Error(\"两次输入的密码不一致\"));\n          }\n        }],\n        employeeKey: [{\n          required: false\n        }],\n        phone: [{\n          required: false,\n          pattern: /^\\S{11,11}$/,\n          message: \"请输入正确的手机号\"\n        }]\n      }\n    };\n  },\n  methods: {\n    async logins() {\n      await this.handleSubmit(this.registerForm);\n    },\n    async handleSubmit(values) {\n      const authStore = useAuthStore();\n      const router = useRouter();\n      console.log(\"Username:\", values.username);\n      console.log(\"Password:\", values.password);\n      console.log(\"EmployeeKey:\", values.employeeKey);\n      try {\n        const data = await authStore.login({\n          username: values.username,\n          password: values.password,\n          employeeKey: values.employeeKey\n        });\n        authStore.user.username = data.data;\n        authStore.user.token = data.token;\n        await nextTick(); // 确保 DOM 更新完成\n        message.success(\"登录成功\");\n        await router.push({\n          path: \"/\",\n          replace: true\n        });\n      } catch (error) {\n        console.error(\"Login failed:\", error);\n        message.error(\"登录失败\");\n      }\n    },\n    handleCancel() {\n      this.$router.push(\"/\");\n      this.isModalVisible = false; // 关闭模态框\n    }\n  }\n};","map":{"version":3,"names":["axios","reactive","useAuthStore","useRouter","Form","Input","Button","Card","Layout","InputPassword","message","components","Content","Item","data","registerForm","username","password","confirm","employeeKey","phone","rules","required","trigger","pattern","validator","_","value","Promise","resolve","reject","Error","methods","logins","handleSubmit","values","authStore","router","console","log","login","user","token","nextTick","success","push","path","replace","error","handleCancel","$router","isModalVisible"],"sources":["E:\\code\\Django\\project\\front\\front\\src\\components\\EnrollWindow.vue"],"sourcesContent":["<template>\r\n  <a-layout class=\"layout\">\r\n    <a-layout-content style=\"padding: 24px\">\r\n      <a-card title=\"新用户注册\" :bordered=\"false\">\r\n        <a-form :model=\"registerForm\" :rules=\"rules\" @finish=\"logins\">\r\n          <a-form-item\r\n            name=\"username\"\r\n            label=\"新用户名\"\r\n            :labelCol=\"{ span: 24 }\"\r\n            :wrapperCol=\"{ span: 24 }\"\r\n            hasFeedback\r\n          >\r\n            <a-input v-model:value=\"registerForm.username\" />\r\n          </a-form-item>\r\n          <a-form-item\r\n            name=\"password\"\r\n            label=\"密码\"\r\n            :labelCol=\"{ span: 24 }\"\r\n            :wrapperCol=\"{ span: 24 }\"\r\n            hasFeedback\r\n          >\r\n            <a-input-password v-model:value=\"registerForm.password\" />\r\n          </a-form-item>\r\n          <a-form-item\r\n            name=\"confirm\"\r\n            label=\"确认密码\"\r\n            :labelCol=\"{ span: 24 }\"\r\n            :wrapperCol=\"{ span: 24 }\"\r\n            hasFeedback\r\n          >\r\n            <a-input-password v-model:value=\"registerForm.confirm\" />\r\n          </a-form-item>\r\n          <a-form-item\r\n            name=\"employeeKey\"\r\n            label=\"员工密钥（可选）\"\r\n            :labelCol=\"{ span: 24 }\"\r\n            :wrapperCol=\"{ span: 24 }\"\r\n          >\r\n            <a-input v-model:value=\"registerForm.employeeKey\" />\r\n          </a-form-item>\r\n          <a-form-item\r\n            name=\"phone\"\r\n            label=\"手机号（可选）\"\r\n            :labelCol=\"{ span: 24 }\"\r\n            :wrapperCol=\"{ span: 24 }\"\r\n          >\r\n            <a-input v-model:value=\"registerForm.phone\" />\r\n          </a-form-item>\r\n          <a-form-item :wrapperCol=\"{ span: 24, offset: 0 }\">\r\n            <a-button type=\"primary\" htmlType=\"submit\">提交注册</a-button>\r\n            <a-button style=\"margin-left: 8px\" @click=\"handleCancel\"\r\n              >取消注册</a-button\r\n            >\r\n          </a-form-item>\r\n        </a-form>\r\n      </a-card>\r\n    </a-layout-content>\r\n  </a-layout>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport { reactive } from \"vue\";\r\nimport { useAuthStore } from \"@/storage/userStorage\";\r\nimport { useRouter } from \"vue-router\";\r\nimport {\r\n  Form,\r\n  Input,\r\n  Button,\r\n  Card,\r\n  Layout,\r\n  InputPassword,\r\n  message,\r\n} from \"ant-design-vue\";\r\n\r\nexport default {\r\n  components: {\r\n    \"a-layout\": Layout,\r\n    \"a-layout-content\": Layout.Content,\r\n    \"a-card\": Card,\r\n    \"a-form-item\": Form.Item,\r\n    \"a-input\": Input,\r\n    \"a-input-password\": InputPassword,\r\n    \"a-button\": Button,\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      registerForm: reactive({\r\n        username: \"\",\r\n        password: \"\",\r\n        confirm: \"\",\r\n        employeeKey: \"\",\r\n        phone: \"\",\r\n      }),\r\n      rules: {\r\n        username: [\r\n          {\r\n            required: false,\r\n            message: \"请输入正确的用户名\",\r\n            trigger: /^\\S{4,10}$/,\r\n          },\r\n        ],\r\n        password: [\r\n          {\r\n            required: false,\r\n            message: \"请输入正确的密码\",\r\n            pattern: /^\\S{8,16}$/,\r\n          },\r\n        ],\r\n        confirm: [\r\n          { required: false, message: \"请确认密码\", trigger: \"blur\" },\r\n          {\r\n            validator: (_, value) => {\r\n              // 使用箭头函数来捕获外围作用域中的 this\r\n              if (!value || value === this.registerForm.password) {\r\n                return Promise.resolve();\r\n              }\r\n              return Promise.reject(new Error(\"两次输入的密码不一致\"));\r\n            },\r\n          },\r\n        ],\r\n        employeeKey: [{ required: false }],\r\n        phone: [\r\n          {\r\n            required: false,\r\n            pattern: /^\\S{11,11}$/,\r\n            message: \"请输入正确的手机号\",\r\n          },\r\n        ],\r\n      },\r\n    };\r\n  },\r\n\r\n  methods: {\r\n    async logins() {\r\n      await this.handleSubmit(this.registerForm);\r\n    },\r\n    async handleSubmit(values) {\r\n      const authStore = useAuthStore();\r\n      const router = useRouter();\r\n      console.log(\"Username:\", values.username);\r\n      console.log(\"Password:\", values.password);\r\n      console.log(\"EmployeeKey:\", values.employeeKey);\r\n      try {\r\n        const data = await authStore.login({\r\n          username: values.username,\r\n          password: values.password,\r\n          employeeKey: values.employeeKey,\r\n        });\r\n        authStore.user.username = data.data;\r\n        authStore.user.token = data.token;\r\n        await nextTick(); // 确保 DOM 更新完成\r\n        message.success(\"登录成功\");\r\n        await router.push({\r\n          path: \"/\",\r\n          replace: true,\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Login failed:\", error);\r\n        message.error(\"登录失败\");\r\n      }\r\n    },\r\n    handleCancel() {\r\n      this.$router.push(\"/\");\r\n      this.isModalVisible = false; // 关闭模态框\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.layout {\r\n  height: 100vh;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}