{"ast":null,"code":"import { createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = {\n  key: 1\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_a_select_option = _resolveComponent(\"a-select-option\");\n  const _component_a_select = _resolveComponent(\"a-select\");\n  const _component_a_form_item = _resolveComponent(\"a-form-item\");\n  const _component_a_button = _resolveComponent(\"a-button\");\n  const _component_a_form = _resolveComponent(\"a-form\");\n  const _component_a_card = _resolveComponent(\"a-card\");\n  const _component_a_tag = _resolveComponent(\"a-tag\");\n  const _component_a_rate = _resolveComponent(\"a-rate\");\n  const _component_a_table = _resolveComponent(\"a-table\");\n  const _component_a_pagination = _resolveComponent(\"a-pagination\");\n  const _component_a_layout_footer = _resolveComponent(\"a-layout-footer\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_a_card, null, {\n    default: _withCtx(() => [_createVNode(_component_a_form, {\n      layout: \"inline\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_a_form_item, {\n        label: \"选择条件\",\n        class: \"form-item\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_a_select, {\n          value: _ctx.queryParam.selectedOption,\n          \"onUpdate:value\": _cache[0] || (_cache[0] = $event => _ctx.queryParam.selectedOption = $event),\n          placeholder: \"请选择\",\n          class: \"form-item-button-one\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_a_select_option, {\n            value: \"normal\"\n          }, {\n            default: _withCtx(() => _cache[2] || (_cache[2] = [_createTextVNode(\"正常\")])),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_a_select_option, {\n            value: \"Low_battery\"\n          }, {\n            default: _withCtx(() => _cache[3] || (_cache[3] = [_createTextVNode(\"低电量(低于20%)\")])),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_a_select_option, {\n            value: \"maintenance\"\n          }, {\n            default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\"待维护\")])),\n            _: 1 /* STABLE */\n          })]),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"value\"])]),\n        _: 1 /* STABLE */\n      }), _createVNode(_component_a_form_item, null, {\n        default: _withCtx(() => [_createVNode(_component_a_button, {\n          type: \"primary\",\n          onClick: _ctx.handleSearch,\n          class: \"form-item-button-tow\"\n        }, {\n          default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\" 查询 \")])),\n          _: 1 /* STABLE */\n        }, 8 /* PROPS */, [\"onClick\"])]),\n        _: 1 /* STABLE */\n      })]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }), _createVNode(_component_a_table, {\n    columns: _ctx.columns,\n    \"data-source\": _ctx.getPagedData(),\n    \"row-key\": record => record.id,\n    pagination: false,\n    onChange: _ctx.handleSortChange\n  }, {\n    bodyCell: _withCtx(({\n      column,\n      record\n    }) => [column.key === 'name' ? (_openBlock(), _createElementBlock(\"a\", _hoisted_1, _toDisplayString(record.name), 1 /* TEXT */)) : column.key === 'tags' ? (_openBlock(), _createElementBlock(\"span\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(record.tags, tag => {\n      return _openBlock(), _createBlock(_component_a_tag, {\n        key: tag,\n        color: tag === 'loser' ? 'volcano' : tag.length > 5 ? 'geekblue' : 'green'\n      }, {\n        default: _withCtx(() => [_createTextVNode(_toDisplayString(tag.toUpperCase()), 1 /* TEXT */)]),\n        _: 2 /* DYNAMIC */\n      }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"color\"]);\n    }), 128 /* KEYED_FRAGMENT */))])) : column.key === 'rate' ? (_openBlock(), _createBlock(_component_a_rate, {\n      key: 2,\n      value: record.rating,\n      disabled: \"\",\n      \"allow-half\": \"\"\n    }, null, 8 /* PROPS */, [\"value\"])) : _createCommentVNode(\"v-if\", true)]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"columns\", \"data-source\", \"row-key\", \"onChange\"]), _createVNode(_component_a_layout_footer, null, {\n    default: _withCtx(() => [_createVNode(_component_a_pagination, {\n      modelValue: _ctx.current,\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.current = $event),\n      total: _ctx.totalItems,\n      \"page-size\": _ctx.pageSize,\n      onChange: _ctx.handlePageChange,\n      \"show-less-items\": \"\"\n    }, null, 8 /* PROPS */, [\"modelValue\", \"total\", \"page-size\", \"onChange\"])]),\n    _: 1 /* STABLE */\n  })], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["key","_createElementBlock","_Fragment","_createVNode","_component_a_card","default","_withCtx","_component_a_form","layout","_component_a_form_item","label","class","_component_a_select","value","_ctx","queryParam","selectedOption","_cache","$event","placeholder","_component_a_select_option","_createTextVNode","_","_component_a_button","type","onClick","handleSearch","_component_a_table","columns","getPagedData","record","id","pagination","onChange","handleSortChange","bodyCell","column","_hoisted_1","_toDisplayString","name","_hoisted_2","_renderList","tags","tag","_createBlock","_component_a_tag","color","length","toUpperCase","_component_a_rate","rating","disabled","_createCommentVNode","_component_a_layout_footer","_component_a_pagination","modelValue","current","total","totalItems","pageSize","handlePageChange"],"sources":["E:\\code\\Django\\project\\front\\front\\src\\components\\Data_Sheet.vue"],"sourcesContent":["<template>\r\n  <a-card>\r\n    <a-form layout=\"inline\">\r\n      <a-form-item label=\"选择条件\" class=\"form-item\">\r\n        <a-select\r\n          v-model:value=\"queryParam.selectedOption\"\r\n          placeholder=\"请选择\"\r\n          class=\"form-item-button-one\"\r\n        >\r\n          <a-select-option value=\"normal\">正常</a-select-option>\r\n          <a-select-option value=\"Low_battery\">低电量(低于20%)</a-select-option>\r\n          <a-select-option value=\"maintenance\">待维护</a-select-option>\r\n        </a-select>\r\n      </a-form-item>\r\n      <a-form-item>\r\n        <a-button\r\n          type=\"primary\"\r\n          @click=\"handleSearch\"\r\n          class=\"form-item-button-tow\"\r\n        >\r\n          查询\r\n        </a-button>\r\n      </a-form-item>\r\n    </a-form>\r\n  </a-card>\r\n\r\n  <a-table\r\n    :columns=\"columns\"\r\n    :data-source=\"getPagedData()\"\r\n    :row-key=\"(record) => record.id\"\r\n    :pagination=\"false\"\r\n    @change=\"handleSortChange\"\r\n  >\r\n    <template v-slot:bodyCell=\"{ column, record }\">\r\n      <template v-if=\"column.key === 'name'\">\r\n        <a>{{ record.name }}</a>\r\n      </template>\r\n      <template v-else-if=\"column.key === 'tags'\">\r\n        <span>\r\n          <a-tag\r\n            v-for=\"tag in record.tags\"\r\n            :key=\"tag\"\r\n            :color=\"\r\n              tag === 'loser'\r\n                ? 'volcano'\r\n                : tag.length > 5\r\n                ? 'geekblue'\r\n                : 'green'\r\n            \"\r\n          >\r\n            {{ tag.toUpperCase() }}\r\n          </a-tag>\r\n        </span>\r\n      </template>\r\n      <template v-else-if=\"column.key === 'rate'\">\r\n        <a-rate :value=\"record.rating\" disabled allow-half />\r\n      </template>\r\n    </template>\r\n  </a-table>\r\n\r\n  <a-layout-footer>\r\n    <a-pagination\r\n      v-model=\"current\"\r\n      :total=\"totalItems\"\r\n      :page-size=\"pageSize\"\r\n      @change=\"handlePageChange\"\r\n      show-less-items\r\n    />\r\n  </a-layout-footer>\r\n</template>\r\n\r\n<script>\r\nimport { defineComponent, ref, onMounted, watch } from \"vue\";\r\nimport { getTramSorted, searchCriteria } from \"@/api/tram\";\r\n\r\nexport default defineComponent({\r\n  setup() {\r\n    // 查询参数\r\n    const queryParam = ref({\r\n      selectedOption: \"\", // 默认选项为空\r\n    });\r\n\r\n    // 表格数据\r\n    const data = ref([]);\r\n    const sortedData = ref([]); // 排序后的数据\r\n\r\n    // 分页参数\r\n    const current = ref(1);\r\n    const pageSize = ref(7); // 设置每页数量为7\r\n    const totalItems = ref(0);\r\n\r\n    // 获取当前页数据\r\n    const getPagedData = () => {\r\n      const startIndex = (current.value - 1) * pageSize.value;\r\n      const endIndex = startIndex + pageSize.value;\r\n      return sortedData.value.slice(startIndex, endIndex); // 返回当前页数据\r\n    };\r\n\r\n    // 处理查询\r\n    const handleSearch = async () => {\r\n      try {\r\n        console.log(queryParam.value); // 打印选中的查询条件\r\n        const response = await searchCriteria(queryParam.value);\r\n\r\n        if (response.data.code === 0) {\r\n          // 数据格式化及排序\r\n          const formattedData = response.data.data.map((item) => ({\r\n            ...item,\r\n            tags:\r\n              item.tags && typeof item.tags === \"string\" // 确保 tags 字段存在且为字符串\r\n                ? item.tags\r\n                    .split(\";\")\r\n                    .map((tag) => tag.trim())\r\n                    .filter((tag, index, self) => self.indexOf(tag) === index)\r\n                : [], // 如果没有 tags 字段，返回空数组\r\n          }));\r\n\r\n          // 按 id 字段升序排序\r\n          sortedData.value = formattedData.sort((a, b) => a.id - b.id);\r\n          totalItems.value = sortedData.value.length;\r\n        } else {\r\n          console.log(response.data.message || \"No data found\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error searching data:\", error);\r\n      }\r\n    };\r\n\r\n    // 默认加载排序后的数据\r\n    onMounted(async () => {\r\n      try {\r\n        const response = await getTramSorted();\r\n        console.log(response.data.data);\r\n        if (response.data.code === 0) {\r\n          const formattedData = response.data.data.map((item) => ({\r\n            ...item,\r\n            tags: item.tags\r\n              ? item.tags\r\n                  .split(\";\")\r\n                  .map((tag) => tag.trim())\r\n                  .filter((tag, index, self) => self.indexOf(tag) === index)\r\n              : [], // 如果没有 tags 字段，设置为空数组\r\n          }));\r\n\r\n          // 按 id 字段升序排序\r\n          sortedData.value = formattedData.sort((a, b) => a.id - b.id);\r\n          totalItems.value = sortedData.value.length;\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n      }\r\n    });\r\n\r\n    // 监听 selectedOption 变化，调试用\r\n    watch(\r\n      () => queryParam.value.selectedOption,\r\n      (newValue, oldValue) => {\r\n        console.log(`selectedOption changed from ${oldValue} to ${newValue}`);\r\n      }\r\n    );\r\n\r\n    // 分页改变时，触发此方法\r\n    const handlePageChange = (page) => {\r\n      current.value = page;\r\n    };\r\n\r\n    // 监听排序\r\n    const handleSortChange = (pagination, filters, sorter) => {\r\n      // 根据 sorter 对数据进行排序\r\n      if (sorter.field) {\r\n        sortedData.value.sort((a, b) => {\r\n          if (a[sorter.field] < b[sorter.field])\r\n            return sorter.order === \"ascend\" ? -1 : 1;\r\n          if (a[sorter.field] > b[sorter.field])\r\n            return sorter.order === \"ascend\" ? 1 : -1;\r\n          return 0;\r\n        });\r\n      }\r\n    };\r\n\r\n    const columns = [\r\n      {\r\n        title: \"编号\",\r\n        dataIndex: \"id\",\r\n        key: \"id\", // 唯一标识\r\n        defaultSortOrder: \"ascend\", // 默认按升序排列\r\n        sorter: (a, b) => a.id - b.id, // 按 id 字段升序排序\r\n      },\r\n      {\r\n        title: \"当前车辆所属停车点\",\r\n        dataIndex: \"current_location\",\r\n        key: \"current_location\", // 唯一标识\r\n      },\r\n      {\r\n        title: \"当前车辆所属状态\",\r\n        dataIndex: \"status\",\r\n        key: \"status\", // 唯一标识\r\n      },\r\n      {\r\n        title: \"当前自行车剩余电量\",\r\n        dataIndex: \"remaining_battery\",\r\n        key: \"remaining_battery\", // 唯一标识\r\n        defaultSortOrder: \"descend\",\r\n        sorter: (a, b) => a.remaining_battery - b.remaining_battery,\r\n      },\r\n    ];\r\n\r\n    return {\r\n      queryParam,\r\n      data,\r\n      columns,\r\n      current,\r\n      pageSize,\r\n      totalItems,\r\n      handleSearch,\r\n      getPagedData,\r\n      handlePageChange,\r\n      handleSortChange,\r\n    };\r\n  },\r\n});\r\n</script>\r\n\r\n<style>\r\n/* 你可以在这里添加样式 */\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}